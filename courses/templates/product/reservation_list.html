<!-- ğŸ‘‰ ì˜ˆì•½ ëª©ë¡ (Bootstrap5 + ì•„ì´ì½˜ í¬í•¨) -->
{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
  <h3 class="text-center mb-3">
    <i class="bi bi-calendar-check"></i> ì˜ˆì•½ ëª©ë¡
  </h3>

  <!-- âœ… PC í…Œì´ë¸” -->
  <div class="d-none d-md-block">
    <table class="table table-striped align-middle">
      <thead class="table-light text-center">
        <tr>
          <th><i class="bi bi-building"></i> ê¸°ê´€</th>
          <th><i class="bi bi-journal-code"></i> ìƒí’ˆ</th>
          <th><i class="bi bi-calendar-event"></i> ì¼ì‹œ</th>
          <th><i class="bi bi-people"></i> ì¸ì›</th>
          <th><i class="bi bi-geo-alt"></i> ì¥ì†Œ</th>
          <th><i class="bi bi-flag"></i> ìƒíƒœ</th>
          <th class="text-center"><i class="bi bi-gear"></i> ê´€ë¦¬</th>
        </tr>
      </thead>
      <tbody>
        {% for r in reservations %}
        <tr class="text-center">
          <td>{{ r.institution }}</td>
          <td>{{ r.product.name }}</td>
          <td>{{ r.date }} <br> {{ r.start_time }}~{{ r.end_time }}</td>
          <td>{{ r.headcount }}</td>
          <td>{{ r.place|linebreaksbr }}</td>
          <td>
            <span class="badge 
              {% if r.status == 'approved' %}bg-success
              {% elif r.status == 'rejected' %}bg-danger
              {% elif r.status == 'canceled' %}bg-secondary
              {% else %}bg-dark{% endif %}">
              <i class="bi bi-circle-fill"></i> {{ r.get_status_display }}
            </span>
          </td>
          <!-- âœ… ê´€ë¦¬ ë²„íŠ¼ ì¹¸ (ê°€ë¡œë¡œ ì •ë ¬ ê³ ì •) -->
          <td class="text-nowrap">
            <div class="d-flex justify-content-center gap-2 flex-nowrap">
              {% if request.user.is_staff %}
                {% if r.status == 'approved' %}
                  <a href="{% url 'reservation_confirm' r.id %}" 
                     class="btn btn-sm btn-secondary">ìš”ì²­ìœ¼ë¡œ</a>
                {% elif r.status == 'requested' %}
                  <a href="{% url 'reservation_confirm' r.id %}" 
                     class="btn btn-sm btn-success">í™•ì •</a>
                {% endif %}
                <a href="{% url 'reservation_edit' r.id %}" class="btn btn-sm btn-warning">ìˆ˜ì •</a>
                <a href="{% url 'reservation_cancel' r.id %}" 
                   class="btn btn-sm btn-danger"
                   onclick="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')">ì‚­ì œ</a>
              {% else %}
                {% if r.status != 'canceled' %}
                  <a href="{% url 'reservation_edit' r.id %}" class="btn btn-sm btn-warning">ìˆ˜ì •</a>
                  <a href="{% url 'reservation_cancel' r.id %}" 
                     class="btn btn-sm btn-secondary"
                     onclick="return confirm('ì˜ˆì•½ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')">ì·¨ì†Œ</a>
                {% endif %}
              {% endif %}
            </div>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="7" class="text-center text-muted py-4">
            <i class="bi bi-inbox"></i> ì˜ˆì•½ì´ ì—†ìŠµë‹ˆë‹¤.
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- âœ… ëª¨ë°”ì¼ ì¹´ë“œ -->
  <div class="d-md-none">
    {% for r in reservations %}
    <div class="card mb-2 shadow-sm">
      <div class="card-body">
        <h5 class="text-truncate"><i class="bi bi-journal-code"></i> {{ r.product.name }}</h5>
        <p class="mb-1"><i class="bi bi-building"></i> {{ r.institution }}</p>
        <p class="mb-1"><i class="bi bi-calendar-event"></i> {{ r.date }} {{ r.start_time }}~{{ r.end_time }}</p>
        <p class="mb-1"><i class="bi bi-people"></i> {{ r.headcount }}</p>
        <p class="mb-1"><i class="bi bi-geo-alt"></i> {{ r.place }}</p>
        <div class="my-2">
          <span class="badge 
            {% if r.status == 'approved' %}bg-success
            {% elif r.status == 'rejected' %}bg-danger
            {% elif r.status == 'canceled' %}bg-secondary
            {% else %}bg-dark{% endif %}"> 
            <i class="bi bi-circle-fill"></i> {{ r.get_status_display }}
          </span>
        </div>
        <!-- âœ… ê´€ë¦¬ ë²„íŠ¼ (ëª¨ë°”ì¼: ê°€ë¡œ ì •ë ¬ ìœ ì§€) -->
        <div class="d-flex justify-content-center flex-wrap gap-2">
          {% if request.user.is_staff %}
            {% if r.status == 'approved' %}
              <a href="{% url 'reservation_confirm' r.id %}" 
                 class="btn btn-sm btn-secondary">ëŒ€ê¸°</a>
            {% elif r.status == 'requested' %}
              <a href="{% url 'reservation_confirm' r.id %}" 
                 class="btn btn-sm btn-success">í™•ì •</a>
            {% endif %}
            <a href="{% url 'reservation_edit' r.id %}" class="btn btn-sm btn-warning">ìˆ˜ì •</a>
            <a href="{% url 'reservation_cancel' r.id %}" 
               class="btn btn-sm btn-danger"
               onclick="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')">ì‚­ì œ</a>
          {% else %}
            {% if r.status != 'canceled' %}
              <a href="{% url 'reservation_edit' r.id %}" class="btn btn-sm btn-warning">ìˆ˜ì •</a>
              <a href="{% url 'reservation_cancel' r.id %}" 
                 class="btn btn-sm btn-secondary"
                 onclick="return confirm('ì˜ˆì•½ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')">ì·¨ì†Œ</a>
            {% endif %}
          {% endif %}
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
</div>

<style>


  /* í…ìŠ¤íŠ¸ê°€ ìë™ ì¤„ë°”ê¿ˆ ë˜ë„ë¡ ì„¤ì • */
  .table td, .table th {
    white-space: normal;
    word-break: keep-all; /* ë‹¨ì–´ ë‹¨ìœ„ë¡œ ì¤„ë°”ê¿ˆ (í•œêµ­ì–´ ê°€ë…ì„± â†‘) */
  }

  /* ë²„íŠ¼ì€ ê°€ë¡œë¡œ ë¶™ì—¬ í‘œì‹œ */
  .table td .d-flex {
    flex-wrap: nowrap;
    gap: 0.25rem;
  }
</style>
{% endblock %}
