{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-end mb-3 flex-wrap gap-2">
    <h3 class="mb-0">공지사항</h3>
    {% if request.user.is_staff %}
      <a href="{% url 'notice_create' %}" class="btn btn-primary">+ 새 공지</a>
    {% endif %}
  </div>

  <form method="get" class="card p-3 mb-3">
    <div class="row g-2">
      <div class="col-sm-6 col-md-8">
        <input type="text" name="q" value="{{ q }}" class="form-control" placeholder="제목/내용 검색">
      </div>
      <div class="col-sm-4 col-md-3">
        <select name="audience" class="form-select">
          <option value="">전체 대상</option>
          <option value="all" {% if audience == "all" %}selected{% endif %}>전체</option>
          <option value="parent" {% if audience == "parent" %}selected{% endif %}>학부모</option>
          <option value="student" {% if audience == "student" %}selected{% endif %}>학생</option>
          <option value="teacher" {% if audience == "teacher" %}selected{% endif %}>강사</option>
        </select>
      </div>
      <div class="col-sm-2 col-md-1 d-grid">
        <button class="btn btn-outline-secondary">검색</button>
      </div>
    </div>
  </form>

  {% for n in page_obj %}
  <div class="card mb-2 shadow-sm">
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-center">
        <div class="d-flex align-items-center gap-2">
          {% if n.is_pinned %}
            <span class="badge bg-danger">고정</span>
          {% endif %}
          <a class="h5 mb-0 text-decoration-none" href="{% url 'notice_detail' n.pk %}">{{ n.title }}</a>
        </div>
        <small class="text-muted">{{ n.published_at|date:"Y-m-d H:i" }}</small>
      </div>
      <div class="mt-1">
        <span class="badge bg-light text-dark">대상: {{ n.get_audience_display }}</span>
        <span class="badge bg-light text-dark">조회 {{ n.view_count }}</span>
        {% if request.user.is_staff and n.status != "published" %}
          <span class="badge bg-warning text-dark">임시저장</span>
        {% endif %}
      </div>
    </div>
  </div>
  {% empty %}
    <div class="alert alert-light text-center">표시할 공지사항이 없습니다.</div>
  {% endfor %}

  <nav class="mt-3">
    <ul class="pagination justify-content-center">
      {% if page_obj.has_previous %}
        <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}&q={{ q }}&audience={{ audience }}">이전</a></li>
      {% else %}
        <li class="page-item disabled"><span class="page-link">이전</span></li>
      {% endif %}
      <li class="page-item disabled"><span class="page-link">{{ page_obj.number }} / {{ page_obj.paginator.num_pages }}</span></li>
      {% if page_obj.has_next %}
        <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}&q={{ q }}&audience={{ audience }}">다음</a></li>
      {% else %}
        <li class="page-item disabled"><span class="page-link">다음</span></li>
      {% endif %}
    </ul>
  </nav>
</div>
{% endblock %}
