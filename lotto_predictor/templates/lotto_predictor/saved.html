{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
 
  <!-- âœ… ì¶”ì²œ í˜ì´ì§€ë¡œ ì´ë™ ë²„íŠ¼ -->
  <div class="mb-3 text-end">
    <a href="{% url 'lotto_recommend' %}" class="btn btn-outline-info">
      ğŸ“Š ë¡œë˜ì¶”ì²œë²ˆí˜¸ìƒì„±
    </a>
  </div>

  <!-- âœ… ìµœì‹  íšŒì°¨ ë‹¹ì²¨ë²ˆí˜¸ í‘œì‹œ -->
  {% if latest_result %}
    <div class="card my-3">
      <div class="card-body">
        <h5 class="card-title">ğŸ¯ {{ latest_result.draw_no }}íšŒì°¨ ë‹¹ì²¨ë²ˆí˜¸</h5>
        <p>
          {% for n in latest_result.get_numbers %}
            <span class="badge bg-success">{{ n }}</span>
          {% endfor %}
          <span class="badge bg-warning text-dark">ë³´ë„ˆìŠ¤ {{ latest_result.bonus }}</span>
        </p>
      </div>
    </div>
  {% endif %}

  <h3>ğŸ’¾ ì €ì¥ëœ ì¶”ì²œ ë²ˆí˜¸</h3>

  {% for draw_no, sets in grouped.items %}
    <div class="card my-3 shadow-sm border-0">
      <div class="card-header d-flex justify-content-between align-items-center">
        <span class="fw-bold">{{ draw_no }}íšŒì°¨ ì €ì¥ëœ ì¶”ì²œ</span>
        <form method="post" action="{% url 'delete_recommendations_by_draw' draw_no %}" style="margin:0;">
          {% csrf_token %}
          <button type="submit" class="btn btn-sm btn-danger">íšŒì°¨ ì „ì²´ ì‚­ì œ</button>
        </form>
      </div>
      <ul class="list-group list-group-flush">
        {% for rec in sets %}
          <li class="list-group-item d-flex justify-content-between align-items-center">
            <div>
              <!-- âœ… ì „ëµ ì´ë¦„ ë°°ì§€ -->
              {% if rec.strategy == "freq" %}
                <span class="badge bg-primary">ë¹ˆë„ ê¸°ë°˜</span>
              {% elif rec.strategy == "missed" %}
                <span class="badge bg-warning text-dark">ë¯¸ì¶œí˜„ ê¸°ë°˜</span>
              {% elif rec.strategy == "mixed" %}
                <span class="badge" style="background-color: purple; color: white;">í˜¼í•© ì „ëµ</span>
              {% elif rec.strategy == "core" %}
                <span class="badge bg-success">í•µì‹¬êµ°</span>
              {% elif rec.strategy == "mlrule" %}
                <span class="badge bg-info text-dark">ML + ê·œì¹™ ê¸°ë°˜</span>
              {% endif %}
              â†’

              <!-- âœ… ë²ˆí˜¸ ì¶œë ¥ -->
              {% for n in rec.get_numbers %}
                {% if rec.strategy == "freq" %}
                  <span class="badge bg-primary">{{ n }}</span>
                {% elif rec.strategy == "missed" %}
                  <span class="badge bg-warning text-dark">{{ n }}</span>
                {% elif rec.strategy == "mixed" %}
                  <span class="badge" style="background-color: purple; color: white;">{{ n }}</span>
                {% elif rec.strategy == "core" %}
                  <span class="badge bg-success">{{ n }}</span>
                {% elif rec.strategy == "mlrule" %}
                  <span class="badge bg-info text-dark">{{ n }}</span>
                {% endif %}
              {% endfor %}

              <!-- âœ… ì ì¤‘ ì—¬ë¶€ -->
              {% if rec.is_pending %}
                <span class="ms-2 text-warning fw-bold">â³ ë¯¸ì¶”ì²¨</span>
              {% else %}
                <span class="ms-2 fw-bold text-success">
                  ğŸ¯ {{ rec.match }}ê°œ ì ì¤‘
                  {% if rec.bonus_hit %}+ ë³´ë„ˆìŠ¤{% endif %}
                </span>
              {% endif %}

              <span class="text-muted ms-2 small">{{ rec.created_at|date:"Y-m-d H:i" }}</span>
            </div>

            <!-- âœ… ê°œë³„ ì‚­ì œ -->
            <form method="post" action="{% url 'delete_recommendation' rec.id %}" style="margin:0;">
              {% csrf_token %}
              <button type="submit" class="btn btn-sm btn-outline-danger">ì‚­ì œ</button>
            </form>
          </li>
        {% endfor %}
      </ul>
    </div>
  {% empty %}
    <p class="text-muted">ì•„ì§ ì €ì¥ëœ ì„¸íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
  {% endfor %}
</div>
{% endblock %}
